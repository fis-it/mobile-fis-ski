<!DOCTYPE html>
<html>
	<head>
		<title>m.fis-ski.com</title>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
        <script src="phonegap.js"></script>
        <link rel="stylesheet" href="css/FIS_jquery_mobile.css" type="text/css"/>
        <link rel="stylesheet" href="css/jquery.mobile.structure_1.2.0.min.css" />
        <link rel="stylesheet" href="css/mobile_new.css" type="text/css"/>
        <script src="js/jquery_1.8.2.min.js"></script>
        <script src="js/jquery.mobile_1.2.0.min.js"></script>
        <script>
            document.addEventListener("deviceready", onDeviceReady, false);
            function checkConnectionType() {
                alert("alert 1");
                var networkState = navigator.connection.type;
                alert("alert 2");
                var states = {};
                states[Connection.UNKNOWN]  = 'Unknown connection';
                states[Connection.ETHERNET] = 'Ethernet connection';
                states[Connection.WIFI]     = 'WiFi connection';
                states[Connection.CELL_2G]  = 'Cell 2G connection';
                states[Connection.CELL_3G]  = 'Cell 3G connection';
                states[Connection.CELL_4G]  = 'Cell 4G connection';
                states[Connection.CELL]     = 'Cell generic connection';
                states[Connection.NONE]     = 'No network connection';
                alert("alert 3");
                alert('Connection type: ' + states[networkState]);
            }

            function fct_exitapp()
            {
                if (navigator.app) {
                    alert('Mobile.fis-ski.com need a internet connection, please activate the internet and try again.')
                    navigator.app.exitApp();
                } else {
                    $("#loading").html('Mobile.fis-ski.com need a internet connection, please activate the internet and try again.');
                    $("#loading").show();
                    $("#tryagain").show();
                }
            }
            function fct_clearcache()
            {
                $("#loading").show();
                /*if (navigator.app) {
                    navigator.app.clearCache();
                }*/
                 var ref = window.open('http://m.fisski.com', '_self', 'location=no');
                //ref.addEventListener('loadstart', function() { alert('start: ' + event.url); });
                //ref.addEventListener('loadstop', function() { alert('stop: ' + event.url); });
                //ref.addEventListener('exit', function() { alert(event.type); });

            }
            function onDeviceReady() {
                //document.addEventListener("backbutton", onBackbuttonPress, false);
                $(document).ready(function(){
                    checkConnection();
                });
                /*debuglog();
                alert("document.close()");
                document.close();
                alert("window.close()");
                window.close();*/
            }
            
            function printObject(o) {
                var out = '';
                for (var p in o) {
                  out += '<strong>'+ p + '</strong>: ' + o[p] + "\r\n<br/>";
                }
                alert(out);
            }
            function debuglog()
            {
                document.write("<h2>navigator.connection</h2>"+navigator.connection);
                //document.write("<h2>Object Navigator</h2>");
                printObject(navigator.connection);
                document.write("<h2>Connection</h2>");
                printObject(Connection);
                document.write("<h2>Object Navigator.device.capture</h2>");
                printObject(navigator.device.capture);
                document.write("<h2>Object history</h2>");
                printObject(history);
                document.write("<h2>Object document</h2>");
                printObject(document);
                //document.write("<h2>Object window</h2>");
                //printObject(window);
            }            
            function checkConnection() {
                alert("hello");
                debuglog();
                //checkConnectionType();
                $("#tryagain").hide();
                //var connectionStatus = ((navigator.onLine) ? 'online' : 'offline');
                //alert('ok2');
                //alert(connectionStatus);
                //printObject(navigator);
                /*if (networkState != 'none'){
                   if (history.length > 1){
                        if (confirm("Are you sure do you want quit mobile.fisski.com?") && navigator.app){
                            navigator.app.exitApp();
                        } else {
                            fct_clearcache();
                            
                            //top.document.location = 'http://m.fisski.com?inapp=true';
                        }
                    } else {
                        fct_clearcache();
                        //top.document.location = 'http://m.fisski.com?inapp=true';
                    }
                } else {
                    $("#loading").hide();
                    fct_exitapp();
                }*/
            }
        </script>
	</head>
	<body>
        <div id="container">
            <div data-role="page" data-theme="a">
                <div data-role="header" data-position="inline">
                <div id="fis-home"></div><h1 class="ui-title">FIS-Ski mobile</h1>
                </div>
                <div data-role="content">
                    <ul data-inset="true" data-dividertheme="a" data-theme="a" class="ui-listview" data-role="listview" >
                        <li data-role="list-divider" role="heading" id="loading" style="display:none">Loading...</li>
                        <li id="tryagain" style="display: none">
                            <a href="javascript:checkConnection();" data-transition="slide">Click here to try again</a></li>
                        <li>
                    </ul>
                </div>
            </div>
        </div>
	</body>
</html>
